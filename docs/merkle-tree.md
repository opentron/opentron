# Merkle Tree

Merkle Tree 在若干块无法通过验证. 实际证明是 protobuf 实现问题, 如果 protobuf 实现无法支持 unknown fields,
或者 unknown fields 验证过于严格, 那么在若干早期块会无法验证 Merkle Tree Root Hash.

- malformed `Transaction.ret` field `2a022200`
  - `2a` 00101_010, field 5, Length-delimited: `Transaction.ret`
  - `02` length = 2
  - `2200` error while pasring
- duplicated `Transaction.ret` field generated by TYVJ8JuQ6ctzCa2u79MFmvvNQ1U2tYQEUM

例如:

```
! mismatch block => 1102553 0x000000000010d2d9afcec842edb2adbfebd691da539e2378d457d68c25d7bc3d

block saved => 0x529a20678416abc03ac25ed047a87fad9b4b31aac354a74f57e5c7b9c3c04526
calculated  => 0xb79d9143ded444fc5c42f2116f6f44c98a7edd7ed11a462a0d136d7ca23e7df8
  merkle tree=529a20678416abc03ac25ed047a87fad9b4b31aac354a74f57e5c7b9c3c04526
  header verify => true
  txn 0 0x05abea02189911967fd3950e0640ba93ddde3e2151de745be70f144a112adf23 verify=true

hashes = [0xb79d9143ded444fc5c42f2116f6f44c98a7edd7ed11a462a0d136d7ca23e7df8]
```

In proto2

0a86010a02d2d722086cedeefc5a6d9c874098a2e1d0cf2c5a68080112640a2d747970652e676f6f676c65617069732e636f6d2f70726f746f636f6c2e5472616e73666572436f6e747261637412330a15417b655bb5e343f447cb6fddae5b319982e4df09e31215410d1db651b7f21610df1eeff0d1a7795cd684c86018b586d00170b2deddd0cf2c1241f8c6e670faacd562aa56954c1dad034e509355e550a9b388f179b0a05ad7b3e4458c73bb5f191780b7d22b6d570c3c7c38f26d8f4b9d18d83c7b583933cf027b00 2a00

In proto

0a86010a02d2d722086cedeefc5a6d9c874098a2e1d0cf2c5a68080112640a2d747970652e676f6f676c65617069732e636f6d2f70726f746f636f6c2e5472616e73666572436f6e747261637412330a15417b655bb5e343f447cb6fddae5b319982e4df09e31215410d1db651b7f21610df1eeff0d1a7795cd684c86018b586d00170b2deddd0cf2c1241f8c6e670faacd562aa56954c1dad034e509355e550a9b388f179b0a05ad7b3e4458c73bb5f191780b7d22b6d570c3c7c38f26d8f4b9d18d83c7b583933cf027b00 2a022200

```
2a02220

2a .ret: type bytes/string

02 length = 2

2200 ??? 此时无法解析:

22 => 0b100010

0b100 -> field_number = 4
010   -> bytes/string
??  出错
```

在早期 protocol commit 9b65a5a926e09d933b67dd7c69e421d59c55a8c0 发现有如下定义:

```
ResourceReceipt receipt = 4;

message ResourceReceipt {
  int64 cpu_usage = 1;
  int64 net_usage = 2;
  int64 storage_delta = 3;
}
```

其他情况 blk 1117928, txn=3, 0edfaa78184bc39de6533da1984277ba0b40c7366d01b246f20fd72fe514b6c9.

## Failed Match

`2a022200` surfix; 2 ret fields but 1 transaction

113 blocks.

```
! mismatch block => 1102553 0x000000000010d2d9afcec842edb2adbfebd691da539e2378d457d68c25d7bc3d
! mismatch block => 1103364 0x000000000010d604a084548eb0535d34b1cfe2748bb874096c8fde0b11612f28
! mismatch block => 1103650 0x000000000010d7227469762a9101f9d9444f2e5971cc40c6dd5dbc472055a789
! mismatch block => 1104274 0x000000000010d992ff9019c363476e6b072664443bd07f01c663baba8a2b5d28
! mismatch block => 1104326 0x000000000010d9c64602cffbcc574ed8b26233d5e1d852d210806c7f4d5d4d03
! mismatch block => 1104948 0x000000000010dc34344f8501c0da4ee21901d5a8ffbb3371aec760feaa0491cc
! mismatch block => 1105494 0x000000000010de560233ebd6e8f9c46ef6e3da8a832c4db51b68e3928e55e779
! mismatch block => 1106300 0x000000000010e17ca445943ca4b7ea10d08732d07ff7d5b63413745cfb9655e3
! mismatch block => 1106888 0x000000000010e3c8f8e0f16afc5d3f2dc0989c545770c2bdeab3e26cba2602e9
! mismatch block => 1107730 0x000000000010e71211421377dc4663a01a1a89a29f37e29db216289f8d7eb786
! mismatch block => 1110468 0x000000000010f1c47076738fc758e0a749be1c9c125d668e2275bdc76dc6ec9f
! mismatch block => 1110780 0x000000000010f2fc4bda92f1cc0408d2f96c35897b73c16b803e26e33de1abc6
! mismatch block => 1110832 0x000000000010f3306ea139a6a69e57b3a3c62282c37d28ab2a04e69c0dc880b3
! mismatch block => 1111222 0x000000000010f4b656da112f1faed15b511c0a5a0cafa8bf7f11fa06fbcde71e
! mismatch block => 1111430 0x000000000010f58661865318e2890201022328a3c30e2811c4bf37f013d9a5af
! mismatch block => 1111508 0x000000000010f5d4a937fa7e9bee7f5853c8187b255f23214159c856b6020d7d
! mismatch block => 1111818 0x000000000010f70a697787808f42730be3d32fbe4903d4cfc6fec94c08fd2c9b
! mismatch block => 1111896 0x000000000010f7580f4b5b54b60bf1eb0442c31b67ab90877cfe39ecef72eb7f
! mismatch block => 1111922 0x000000000010f7724f5cbc004ee32734656ef0320332b8b3b6f2aad7fe60d81f
! mismatch block => 1111966 0x000000000010f79e388bcef1c101a37f6fc3a2d4da41ec5a65c9cb83e239aee6
! mismatch block => 1112021 0x000000000010f7d54fd4b83da8ca5e31d75af1a89dcf4227a8e6cc56f14a70d0
! mismatch block => 1112052 0x000000000010f7f47e6521ec5067fde09bf5762eea11e300769c69a36cabc2d0
! mismatch block => 1112078 0x000000000010f80e3ab55ab994cc75be3a68928c0483c43402e59f20fd357326
! mismatch block => 1112099 0x000000000010f82367c3ffa54dfcb3b5325f1e5828d7dc09e844ad53e7a9354e
! mismatch block => 1112104 0x000000000010f82847d3047abc2a4e53e9bc90e61f1c65b6119a844ef62acfb8
! mismatch block => 1112122 0x000000000010f83a7bef6bb581ad2d64d4ff89937afd48802fc74bd6a8fd8c7f
! mismatch block => 1112130 0x000000000010f842eb048cf47ba3c2b0a8ff18a2b514b5f003e4c1d01412dbde
! mismatch block => 1112156 0x000000000010f85cb688c1655884f97dc380658b18ea730385724cea5965d125
! mismatch block => 1112564 0x000000000010f9f4b5d58e46730e4736ae74add27555688421fd6db9ac59892c
! mismatch block => 1112668 0x000000000010fa5cc5dac2330fd48a658c252100decf7ee778dbf33387e27102
! mismatch block => 1113222 0x000000000010fc860f9c2bded6cdb001edd2192211f29f91276288c0223e73f8
! mismatch block => 1114106 0x000000000010fffacb0c1321217ce083fbf7a648bf56591b8d0fbe997e70ac47
! mismatch block => 1114124 0x000000000011000c3844fcead5f47a69fda19a9c58f482f0a563ebb724fbbd89
! mismatch block => 1114205 0x000000000011005dd0c83c714ef2963c2b46fc524b6e662c0e31ac8b800e5115
! mismatch block => 1114444 0x000000000011014c984bdd2d8ec89d2648be623eb38565947b094d0621a177f3
! mismatch block => 1114522 0x000000000011019abab67a845d361fad06d90d13c84f4805e3f5430a642d33ff
! mismatch block => 1114548 0x00000000001101b4feb86d5fb5164169ed9df27464722fa7fbbd711a7ea20aa4
! mismatch block => 1114938 0x000000000011033a324b698f9f9c1a40e4e04dbc186fc32e7ad3675c4b64a972
! mismatch block => 1115536 0x0000000000110590acffc5173cb6cb067542c9d895136c8791814ccaf410c589
! mismatch block => 1115640 0x00000000001105f8f3fe3c50bd29c264c3d4999a9290b338dcc8185b5c69eadd
! mismatch block => 1115788 0x000000000011068c5c4cd0d7d9405cdcdaddf447694ee0ec46c0b65f4c287241
! mismatch block => 1115822 0x00000000001106aee62538248d6d591734324229e438673d3ffa2c31dc65475f
! mismatch block => 1116264 0x000000000011086864bb1277f80b90c56b1ab726dbf2260150b053d0df962373
! mismatch block => 1116282 0x000000000011087ad17ce363ccb9b413c9d807ffa60455d7c40cf0baa0a150d2
! mismatch block => 1116308 0x0000000000110894beadf82733e42b355e8488c9f1d1398bad74f058cb68351a
! mismatch block => 1116386 0x00000000001108e243ae34aef5033ee763a4522e08bc63e7e2ccea60589bcb0a
! mismatch block => 1116706 0x0000000000110a22926840c743c004ccc0fdcb1a67810397c5c63e109372a457
! mismatch block => 1116732 0x0000000000110a3c212c383e4cea5c0274f65e9763e93aeb6cf556e57a873840
! mismatch block => 1116984 0x0000000000110b38f0dd8e42357738450b476d8914a6a50016b76b9beb4feeaf
! mismatch block => 1117018 0x0000000000110b5aab0260b0dd3c024c3f7cdc5a7e31f8aa3c18924f61cde181
! mismatch block => 1117460 0x0000000000110d14fe3db09f79619ef24ed5e78d1e8ab367504127643e5ceb52
! mismatch block => 1117668 0x0000000000110de4f768e18cab93243573994828c9c3eeff16b8643b443ec6e1
! mismatch block => 1117694 0x0000000000110dfe7558fe65ff9be35051061e98e7d6975cc70693bbaef43d12
! mismatch block => 1117928 0x0000000000110ee8168ed894a16c9660091b9563b0dcc2fe5dd406d1985f1599
! mismatch block => 1118050 0x0000000000110f62e249738aebd9e8a01d85ca9b7d278472c48498b36e51905c
! mismatch block => 1118292 0x0000000000111054ea8c9f9535670e19b08eca065e691755b864f48285635f89
! mismatch block => 1118370 0x00000000001110a29a18252214f52cfb84da061abb26f8a5dd18d9c1fc39bea6
! mismatch block => 1118604 0x000000000011118cb4b6c6902d85a2c5a4df3f62976796917669e9ee5c7f5ca1
! mismatch block => 1118758 0x0000000000111226c38bcbde191e6b442549860bb377f82d3fb668906213f89e
! mismatch block => 1118810 0x000000000011125a6a6e1a858150864c97d5699017d7538e89fb05ba9cc929fa
! mismatch block => 1118914 0x00000000001112c21c6d8f90ca36a9124156611b472395c0c3a23f9ec9591d11
! mismatch block => 1118992 0x0000000000111310fcc1189817d5cdb36c6c49a1a2c94b51c46e6a4b254b713d
! mismatch block => 1119460 0x00000000001114e4e70ba5134cf7418cc7ba36fe169a6f30a06c57655ee55854
! mismatch block => 1119486 0x00000000001114fe31950749cb287654312c81f0cf6542fe1586d2287bae4b1d
! mismatch block => 1119642 0x000000000011159a52686ed4f27d69fdd370b37d0e4507db77f8efaef3238fae
! mismatch block => 1119660 0x00000000001115ac3dab88e1ca8a3e64087be6cca262943ad75ab3da217a4252
! mismatch block => 1119772 0x000000000011161c7f30ba70b8e8ce414de4d4bfd9596a86bd23b79c466a9594
! mismatch block => 1120032 0x0000000000111720d9ba7eb59937d4abcd89d4f2a21353f69aaa7bdf4a5a611b
! mismatch block => 1120084 0x00000000001117549e151860f765e5fff8a4a62e7130e9a16462bfcc2d3f45d0
! mismatch block => 1120136 0x00000000001117881ed50a26fdf4e5164cd39dccced0af4b9f219d7fd43f348c
! mismatch block => 1120180 0x00000000001117b4554b9e5d40c8b6c1cf72e66968684cafe4647163cba5ec11
! mismatch block => 1120344 0x0000000000111858c73ac7db147d613415b58864237fd776a181e09b73987666
! mismatch block => 1120370 0x00000000001118729f18c09d961099d8dbdaf1332322a7d070bf42ac1c484111
! mismatch block => 1120388 0x0000000000111884f1425e0f049c31fac6bca971eef56798009aeab9330838df
! mismatch block => 1120422 0x00000000001118a6c9e1ab3b5f92c9e3fc5f426c9bd406b2372eddff0053dd9d
! mismatch block => 1121124 0x0000000000111b64d7fbb1767f2fd79217dd1043b7f002c79e2e76a604740cf0
! mismatch block => 1121228 0x0000000000111bcc8db1ec1808b33627b1a3417d42c02858158a006c26ecfc78
! mismatch block => 1121402 0x0000000000111c7a06f2592d76a8f2b826cc0ab885fbc9672db3a7ae7e73b0a7
! mismatch block => 1121696 0x0000000000111da019d44c8d8a6e40422d2f4775b3ee82e43ec8abca63414e2f
! mismatch block => 1121852 0x0000000000111e3ccb07783ade7c105a0ef15b43b2095a543a53f9a7d8a43107
! mismatch block => 1122736 0x00000000001121b01780a182a38f251a5a1b5e8281573066965c105aed9b415c
! mismatch block => 1123022 0x00000000001122ce73d3bd410d26b2cd1600b96f9f52a795b7634efbb7d58983
! mismatch block => 1123568 0x00000000001124f04da3256a3c1ad05f638caaefaffdc84a0ff9e205c79636c2
! mismatch block => 1123638 0x00000000001125365cf8ed97e283220aa7f4102068fce3051d4f951f60f24b90
! mismatch block => 1123750 0x00000000001125a6fbb5ff9133f3fc4eb297bb698a9ee151ee4941841893c1d5
! mismatch block => 1124166 0x00000000001127462c0e429f063976f46b542e435cc094a1a3f7a6853ba10863
! mismatch block => 1124756 0x0000000000112994a6a693b57891c737dc2b86c232f1038f9d1ea72e0cc7d4f7
! mismatch block => 1124990 0x0000000000112a7e21d6169d45d7df3220a28d2c2fadbcd820c1c1ca649c69d0
! mismatch block => 1125336 0x0000000000112bd8673bd5862ac719b132e3a615993b0fef4b5af1501c867ac1
! mismatch block => 1125518 0x0000000000112c8e97102ca3f49e1589e18f03e0b91d12e25309116682c9aaf8
! mismatch block => 1125750 0x0000000000112d769c9d3fa65e6e57e63657819921eb6b09a2db13d2a99d47ec
! mismatch block => 1125846 0x0000000000112dd64cd592e7df58edf99bb244b4863fc21d80d3d2c96658146c
! mismatch block => 1126314 0x0000000000112faa165ce9d1d66393c21e1257d07f8103fd939d4cf7e9fb0b9f
! mismatch block => 1126340 0x0000000000112fc480bac69b58eb9008196adf689f9a3a4b1afa23f4c8f97ea2
! mismatch block => 1126582 0x00000000001130b6c49457841cd89b99fe6e1b892e42b3c2f15806414b5607fa
! mismatch block => 1127128 0x00000000001132d83c3d5fc5c6a2cd40c7270b88a26a1768c9e974e27fdf6155
! mismatch block => 1127536 0x00000000001134700f5643becd707db2b2dcd8e8f62ce916f1c07ed9abf962c6
! mismatch block => 1128272 0x000000000011375074a6381c8791956e13bc727f6b1c0e9e00ca300f7176f857
! mismatch block => 1129000 0x0000000000113a289af7ae7aecc916fac594fd35fe9123af53508689b4d4f688
! mismatch block => 1129858 0x0000000000113d82500de22a1c6bb8dc7c22bea362bb7d6473d93ae068a0e742
! mismatch block => 1129910 0x0000000000113db682106d812e1cc903abd6838d2ed15c91a978fc9cc409fb07
! mismatch block => 1130118 0x0000000000113e86c58daabdd4ea46aa168a4e674be3f9bd765ccec038428b29
! mismatch block => 1130690 0x00000000001140c2edfd2021c4219989ffc2cd075f9136029eb8a8807d965df3
! mismatch block => 1131028 0x0000000000114214561de26641d150b4b18e47c11d949ea02e88758e6daf2c07
! mismatch block => 1131626 0x000000000011446ad964da7f9e70506f993d53a05a1ebc2c9df42b59c9f85860
! mismatch block => 1132922 0x000000000011497a23cd6359e419ecbccf6c0ba3f8494c81f0e0d2b387fd5a7a
! mismatch block => 1132941 0x000000000011498d1083a3110555c5b83a61df2a4df73dbf2244d79a5bd5ad30
! mismatch block => 1133084 0x0000000000114a1c63ebd216bb8f82581b2507e1906d9a702d39b0c60c866987
! mismatch block => 1134406 0x0000000000114f4681b46f5415e5e2fdebfe9f4fb9e2c8283d7ab0a794db7741
! mismatch block => 1135135 0x000000000011521f120aeadb6305e4e209236d15886d0742d6e8cac1ab27ce3b
! mismatch block => 1135513 0x000000000011539966caae4e80dd120c9d0cebf205b22d838fbc6ca5895de7ae
! mismatch block => 1135675 0x000000000011543b93ac128983ba16025267b072d439887fa5cee647a60a554d
! mismatch block => 1135702 0x000000000011545684f11740738f776ba0c3a41f7527b5d1975a733cd8bb4dc3
! mismatch block => 1135837 0x00000000001154dddf77c2225512da2cd4a1d620c8833697656c03afd846de8d
```

by TYVJ8JuQ6ctzCa2u79MFmvvNQ1U2tYQEUM

11 blocks, txn with duplicated `ret` field.

```
! mismatch block => 1111066 0x000000000010f41ae36cf8db21bff1fa0c84451559c549ff7566d75f977b6d14
  39bed0802db9f1b3a202709ae904e23457f6058ded46c9dddbd2e373d322bfc8   2 ret
! mismatch block => 1112026 0x000000000010f7daae7e7821683cc9a017770690bf71e0cd317cdabf7cb7b64c
  349a82e9d65934516a2550fb4bb16d8437a9bd0a667a10e8d665942b4b7c8329   2 ret
! mismatch block => 1112754 0x000000000010fab237fe273227fabecdc530ad687fc09619a598c595e372419d
  46e3b127a0bf07078f180e30021765ea479f4d4519efeda28aae466da2ea945c   2 ret
! mismatch block => 1116758 0x0000000000110a56007a54e0366b8fa92e79edd8c8b7d3a1c06eaf64efabe378
  433250eb1078ccd89a4cc6800b6be0670ac966e295ef8ad2abe9dc1e2cd3d10b
! mismatch block => 1119408 0x00000000001114b0562499f38b6efd3b44eae4de66a81af502d3a1c4063bd481
  e1833a4ae96440128a18bb1f28189c53e4f21c5ea0eeb3423099eef0d4f7517d
! mismatch block => 1119668 0x00000000001115b4adcdd36ebea2e409cdd5da737baba5263c81324398ce67cc
  4174625946e2c8d34b0f4a65b891c6dbe0c11e27cc640ea0807727f404dbcc26
! mismatch block => 1126192 0x0000000000112f301d4a411906a352006cd68b12a0eb2bb98d9d505cc49f9aae
  57b6876ac337580507c9a4f25753264f0c00f62bbb27dcbf837c3787a5f8b6d4
! mismatch block => 1129962 0x0000000000113dea6dee48ac6831357e1f4b6e51619cfbd2bc8684a03e1c7fb7
  3ec5106338607b06b7807ae51b62033b580b20fc7088e374caa64ed7be2e56de
! mismatch block => 1132976 0x00000000001149b0f6950111ecd3c47f0703c61403070b5e866ce59d161945bd
  bac57ded8f450f3aab9d62676fa858c5e2d766c5b53aadce07c83cd40e4368f9
! mismatch block => 1135918 0x000000000011552ea8d7ad7ca9616f4a0923747c39244702befd5b4efb9ac074
  f97a939dc0d0f9ef06387e5621b832d5ea3950202335dcdb92a6e4925ef2cf39
! mismatch block => 1135972 0x00000000001155640cf40535e81c47098b70ba8866e2fd4a4d0fd0e8e21c5b4e
  443e2448178b0f0041ba5627d815236624a351fd8f94e7882b57462236098797
```

## Other
block = 9023535
txn 7b6b9c9acdfc7920ffe40b63ef1cd5e90e43d0c7587c0c0437e958fc14b8a4d9

ret[1] = "unfreeze_amount": 1000000000000000, ???
